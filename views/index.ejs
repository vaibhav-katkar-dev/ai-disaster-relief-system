
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Aid Now</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
     body, html {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      color: #333;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 30px;
      background-color: #f8f9fa;
      border-bottom: 1px solid #e0e0e0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .header .logo {
      font-size: 1.5em;
      font-weight: bold;
      color: #d32f2f;
    }

    .header .nav a,
    .login-btn {
      margin-left: 20px;
      text-decoration: none;
      color: #1a0dab;
      font-weight: 500;
      font-size: 1em;
    }

    .login-btn {
      background-color: #1a0dab;
      color: #fff;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .login-btn:hover {
      background-color: #163a7a;
    }

    .content {
      padding: 40px 20px;
      text-align: center;
      max-width: 1200px;
      margin: auto;
    }

    .title {
      color: #d32f2f;
      font-size: 2.5em;
    }

    .description {
      color: #6c757d;
      font-size: 1.1em;
      margin-bottom: 30px;
    }

    .buttons .btn {
      background-color: #1a2a44;
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 5px;
      margin: 0 15px;
      font-size: 1em;
      cursor: pointer;
    }

    .buttons .btn:hover {
      background-color: #13263d;
    }

    .map-section {
      margin-top: 40px;
    }

    #disasterMap {
      height: 400px;
      background-color: #f1f1f1;
      border-radius: 8px;
      margin: 20px 0;
    }

    #disasterMap.fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh !important;
      width: 100vw !important;
      z-index: 9999;
      border-radius: 0 !important;
      transition: all 0.3s ease;
    }

    body.fullscreen-map {
      overflow: hidden;
    }

    .view-map-btn {
      background-color: #f1f1f1;
      border: 1px solid #ddd;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      color: #1a2a44;
    }

    .legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
    }

    .legend span {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.9em;
    }

    .status-section {
      margin-top: 40px;
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 8px;
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .status-card {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .status-card h3 {
      color: #1a2a44;
    }

    .how-it-works {
      margin-top: 40px;
      padding: 40px 20px;
      background-color: #f9f9f9;
      border-radius: 8px;
    }

    .how-it-works h2 {
      color: #1a2a44;
    }

    .how-it-works-items {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }

    .how-it-works-item {
      flex: 1;
      min-width: 200px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .how-it-works-item i {
      font-size: 2em;
      margin-bottom: 10px;
    }

    .footer {
      background-color: #1a2a44;
      color: white;
      padding: 40px 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
    }

    .footer-section h3 {
      color: #d32f2f;
    }

    .footer-section a,
    .footer-section p {
      color: #e0e0e0;
      text-decoration: none;
      margin: 8px 0;
    }

    .footer-bottom {
      text-align: center;
      width: 100%;
      margin-top: 20px;
      color: #b0b0b0;
    }
    </style>
    <!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <div class="header">
        <div class="logo">Emergency Aid Now</div>
        <div class="nav">
            <a href="/">Home</a>
            <a href="/reqHelp">Request Help</a>
            <a href="/offHelp">Offer Help</a>
            <a href="/dashboard">Dashboard</a>
            <button class="login-btn">Login</button>
        </div>
    </div>

    <div class="content">
        <h1 class="title">Emergency Aid Now</h1>
        <p class="description">
            Connecting people in need with those who can help during emergencies and natural disasters.
            Request assistance or offer your support to those affected.
        </p>
        <div class="buttons">
            <a href="reqhelp"><button class="btn">Request Help</button></a>
           <a href="offhelp"> <button class="btn">Offer Help</button></a>
        </div>

        <div class="map-section">
            <h2>Real-time Disaster Map</h2>
          
                <div class="map-placeholder" id="disasterMap" style="height: 400px; width: 100%; border-radius: 8px;"></div>

           
            <button class="view-map-btn">View Full Map</button>
            <div class="legend">
                <span><span style="display: inline-block; width: 12px; height: 12px; background-color: #d32f2f; border-radius: 50%;"></span> High Severity</span>
                <span><span style="display: inline-block; width: 12px; height: 12px; background-color: #ffca28; border-radius: 50%;"></span> Medium Severity</span>
                <span><span style="display: inline-block; width: 12px; height: 12px; background-color: #0288d1; border-radius: 50%;"></span> Low Severity</span>
            </div>
        </div>

        <div class="status-section">
            <h2>Current Status</h2>
            <div class="status-grid">
                <div class="status-card">
                    <p>Active Help Requests</p>
                    <h3><%= requests %></h3>

                    <!-- <p>↑ 12% vs last week</p> -->
                </div>
                <div class="status-card">
                    <p>Available Volunteers</p>
                    <h3><%= volunteers %></h3>
                    <!-- <h3>56</h3> -->
                    <!-- <p>↑ 5% vs last week</p> -->
                </div>
                <div class="status-card">
                    <p>Successful Aid Deliveries</p>
                    <h3><%= deliveries %></h3>
                    <!-- <p>↑ 1% vs last week</p> -->
                </div>




               
            </div>
        </div>

        <div class="how-it-works">
            <h2>How It Works</h2>
            <p class="description">
                Our platform connects those in need with volunteers and organizations that can provide assistance during
                emergencies and natural disasters.
            </p>
            <div class="how-it-works-items">
                <div class="how-it-works-item">
                    <i class="fas fa-exclamation-triangle" style="color: #d32f2f;"></i>
                    <h3>Request Help</h3>
                    <p>If you're affected by a disaster, submit a request detailing your location and needs.</p>
                </div>
                <div class="how-it-works-item">
                    <i class="fas fa-user" style="color: #1a2a44;"></i>
                    <h3>Volunteer</h3>
                    <p>Register as a volunteer to offer your services, resources, or expertise to those in need.</p>
                </div>
                <div class="how-it-works-item">
                    <i class="fas fa-check" style="color: #0288d1;"></i>
                    <h3>Get Matched</h3>
                    <p>Our system matches help requests with nearby volunteers who can provide the needed assistance.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="footer-section">
            <h3>Emergency Aid Now</h3>
            <p>Connecting those in need with those who can help during emergencies and natural disasters.</p>
        </div>
        <div class="footer-section">
            <h3>Quick Links</h3>
            <a href="/">Home</a>
            <a href="reqhelo">Request Help</a>
            <a href="offhelp">Offer Help</a>
            <a href="/">Admin Dashboard</a>
        </div>
        <div class="footer-section">
            <h3>Resources</h3>
            <a href="#">Emergency Contacts</a>
            <a href="#">Safety Tips</a>
            <a href="#">About Us</a>
            <a href="#">Privacy Policy</a>
        </div>
        <div class="footer-section">
            <h3>Contact</h3>
            <p><i class="fas fa-envelope"></i> contact@emergencyaidnow.org</p>
            <p><i class="fas fa-phone"></i> +1 (234) 567-890</p>
        </div>
        <div class="footer-bottom">
            <p>© 2025 Emergency Aid Now. All rights reserved.</p>
            <p>Made with <i class="fas fa-heart" style="color: #d32f2f;"></i> for those in need</p>
        </div>
    </div>
    

<!-- Leaflet JS -->
<script>
    const mapContainer = document.getElementById('disasterMap');
    const viewBtn = document.querySelector('.view-map-btn');
  
    let isFullscreen = false;
  
    viewBtn.addEventListener('click', () => {
      isFullscreen = !isFullscreen;
  
      if (isFullscreen) {
        mapContainer.classList.add('fullscreen');
        document.body.classList.add('fullscreen-map');
        viewBtn.innerText = "Exit Full Map";
      } else {
        mapContainer.classList.remove('fullscreen');
        document.body.classList.remove('fullscreen-map');
        viewBtn.innerText = "View Full Map";
      }
  
      // Important: delay resize so Leaflet can adjust to new container size
      setTimeout(() => {
        map.invalidateSize();
      }, 350);
    });
  </script>
  <script>
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape' && isFullscreen) {
        mapContainer.classList.remove('fullscreen');
        document.body.classList.remove('fullscreen-map');
        viewBtn.innerText = "View Full Map";
        isFullscreen = false;
        setTimeout(() => map.invalidateSize(), 300);
      }
    });
  </script>
  
  
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const map = L.map('disasterMap').setView([20.5937, 78.9629], 5); // Center on India

  // Add OpenStreetMap tiles
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  // Severity to color mapping
  const severityColors = {
    High: '#d32f2f',
    Medium: '#ffca28',
    Low: '#0288d1'
  };

  // Fetch disaster data from the API
  fetch('/api/disasters/grouped')
    .then(res => res.json())
    .then(data => {
      for (const severity in data) {
        const color = getColor(severity); // Get color based on severity
        data[severity].forEach(disaster => {
          if (disaster.location && disaster.location.lat && disaster.location.lng) {
            plotMarker(disaster.location.lat, disaster.location.lng, color, disaster.city, severity);
          }
        });
      }
    })
    .catch(err => {
      console.error("Failed to fetch disaster data:", err);
    });

  // Function to plot marker on map
  function plotMarker(lat, lng, color, city, severity) {
    L.circleMarker([lat, lng], {
      radius: 8,
      color: color,
      fillColor: color,
      fillOpacity: 0.9
    }).addTo(map).bindPopup(`<strong>${city}</strong><br>Severity: ${severity}`);
  }

  // Utility to get color based on severity
  function getColor(severity) {
    if (severity === 'High') return '#d32f2f';
    if (severity === 'Medium') return '#ffca28';
    return '#0288d1'; // Default = Low
  }
</script>
<script>
    // Embedded JS
    function toggleFullscreen() {
      const map = document.getElementById("disasterMap");
      document.body.classList.toggle("fullscreen-map");
      map.classList.toggle("fullscreen");
    }
  </script>

</body>
</html>